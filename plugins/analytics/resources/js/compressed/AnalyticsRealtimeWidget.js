Analytics.Realtime=Garnish.Base.extend({init:function(e){this.$element=$("#"+e),this.$title=$(".title",this.$element),this.$body=$(".body",this.$element),this.$spinner=$(".spinner",this.$element),this.$streamstatus=$(".streamstatus",this.$element),this.$error=$(".error",this.$element),this.$realtimeVisitors=$(".analytics-realtime-visitors",this.$element),this.timer=!1,this.start(),setInterval($.proxy(function(){this.$streamstatus.hasClass("hidden")?this.$streamstatus.removeClass("hidden"):this.$streamstatus.addClass("hidden")},this),1e3)},start:function(){this.timer&&this.stop(),this.request(),this.timer=setInterval($.proxy(function(){this.request()},this),1e3*AnalyticsRealtimeInterval)},stop:function(){clearInterval(this.timer)},request:function(){this.$spinner.removeClass("body-loading"),this.$spinner.removeClass("hidden"),Craft.queueActionRequest("analytics/reports/getRealtimeReport",{},$.proxy(function(e,s){if("success"==s&&"undefined"==typeof e.error)this.$error.addClass("hidden"),this.$realtimeVisitors.removeClass("hidden"),this.handleResponse(e);else{var t="An unknown error occured.";"undefined"!=typeof e&&e&&"undefined"!=typeof e.error&&(t=e.error),this.$realtimeVisitors.addClass("hidden"),this.$error.html(t),this.$error.removeClass("hidden")}this.$spinner.addClass("hidden")},this))},handleResponse:function(e){var s=e.newVisitor,t=e.returningVisitor,i=1*t+1*s;if($(".active-visitors .count",this.$realtimeVisitors).text(i),i>0?($(".progress",this.$realtimeVisitors).removeClass("hidden"),$(".legend",this.$realtimeVisitors).removeClass("hidden")):($(".progress",this.$realtimeVisitors).addClass("hidden"),$(".legend",this.$realtimeVisitors).addClass("hidden")),i>0)var r=Math.round(100*s/i);else var r=100;var a=100-r;$(".progress-bar.blue",this.$realtimeVisitors).css("width",r+"%"),$(".progress-bar.blue span",this.$realtimeVisitors).text(r+"%"),r>0?$(".progress-bar.blue",this.$realtimeVisitors).removeClass("hidden"):$(".progress-bar.blue",this.$realtimeVisitors).addClass("hidden"),$(".progress-bar.green",this.$realtimeVisitors).css("width",a+"%"),$(".progress-bar.green span",this.$realtimeVisitors).text(a+"%"),a>0?$(".progress-bar.green",this.$realtimeVisitors).removeClass("hidden"):$(".progress-bar.green",this.$realtimeVisitors).addClass("hidden")}});