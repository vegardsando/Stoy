(function(e){DirectoryInstall=Garnish.Base.extend({$graphic:null,$status:null,$errorDetails:null,data:null,init:function(t){this.$graphic=e("#graphic");this.$status=e("#status");if(!t){this.showError(Craft.t("Unable to determine which plugin to install."));return}this.$handle=t;this.data={handle:t};this.postActionRequest("directory/install/prepare")},updateStatus:function(e){this.$status.html(e)},showError:function(e){this.updateStatus(e);this.$graphic.addClass("error")},postActionRequest:function(t){var n={data:this.data};Craft.postActionRequest(t,n,e.proxy(function(e,t,n){console.log(t,e);t=="success"&&e.alive?this.onSuccessResponse(e):this.onErrorResponse(n)},this),{complete:e.noop})},onSuccessResponse:function(e){e.data&&(this.data=e.data);e.errorDetails&&(this.$errorDetails=e.errorDetails);e.nextStatus&&this.updateStatus(e.nextStatus);e.nextAction&&this.postActionRequest(e.nextAction);e.finished&&this.onFinish(e.returnUrl)},onErrorResponse:function(e){this.$graphic.addClass("error");var t=Craft.t("An error has occurred.")+"<br /><p>"+e.statusText+"</p><br /><p>"+e.responseText+"</p>";this.updateStatus(t)},onFinish:function(t){if(this.$errorDetails){this.$graphic.addClass("error");var n=Craft.t("Directory was unable to install this plugin :(")+"<br /><p>";n+=Craft.t("No files have been updated and the database has not been touched.")+"</p><br /><p>";n+=this.$errorDetails+"</p>";this.updateStatus(n)}else{this.updateStatus(Craft.t("Plugin Installed!"));this.$graphic.addClass("success");setTimeout(e.proxy(function(){e('<form method="post"><input type="hidden" name="redirect" value="directory" /><input type="hidden" name="action" value="plugins/installPlugin" /><input type="hidden" name="pluginClass" value="'+this.$handle+'" />'+"</form>").appendTo("body").submit()},this),500)}}})})(jQuery);